import{r as t,j as e}from"./react-CywZ_8YR.js";import{R as Ue}from"./react-dom-V7lzCc_E.js";import{P as d}from"./prop-types-D0pSn4ZB.js";import{i as He,g as ze,a as _e,b as Ze,c as We,o as Ke,h as he,d as le,s as Ye,e as Ie,f as Je,j as Qe,T as Ne,k as ee,q as X,w as fe,l as V,m as ke,n as ge,p as Re,t as se,u as ne,v as Ge,x as Xe}from"./@firebase-BWzT2wpK.js";import"./firebase-ft0UCR9M.js";import{u as De,N as G,a as ye,L as Oe,R as et,b as M,O as tt,B as st}from"./react-router-Cz7bXzTt.js";import{m as I,A as J}from"./framer-motion-BK0ZBAWD.js";import"./cookie-BX9QSSmL.js";import"./scheduler-BNqrtbQi.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./motion-dom-DnIdl6pN.js";import"./motion-utils-BDWe_Wef.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&a(x)}).observe(document,{childList:!0,subtree:!0});function r(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(l){if(l.ep)return;l.ep=!0;const m=r(l);fetch(l.href,m)}})();const nt="/last-minute/assets/ket-Bp7EiJsM.png",E=({filled:s=!1,onClick:n=()=>{},disabled:r=!1,className:a,children:l,type:m="button"})=>{const[x,f]=t.useState(!1),S=async N=>{r||x||(f(!0),await n(N),f(!1))};return e.jsx("button",{formNoValidate:!0,type:m,onClick:S,className:`${x?"pointer-events-none":""} ${a} px-2.5 py-1 truncate transition-all ${s?"bg-primary text-secondary-text":"bg-transparent text-primary"} ${r||x?"opacity-50 !cursor-not-allowed !hover:border-primary":s?"hover:bg-filled-button-hover hover:border-filled-button-hover active:bg-filled-button-active  active:ring-primary active:ring focus:!ring-background-secondary":"hover:bg-interactive-hover hover:border-filled-button-hover active:bg-interactive-active  active:ring-primary active:ring focus:ring-primary"} border-2 min-w-fit border-primary text-center box-border rounded-md font-semibold text-lg cursor-pointer
       focus:outline-none focus:ring-2`,children:e.jsx("div",{className:`${r?"pointer-events-none":""} transition-transform active:scale-[97%] active:opacity-75 flex gap-2 justify-center`,children:l})})};E.propTypes={filled:d.bool,onClick:d.func,disabled:d.bool,className:d.string,children:d.node.isRequired,type:d.string};const ie=({className:s,header:n,onClick:r,children:a})=>e.jsxs("div",{className:`${s} ${r?"transition-all cursor-pointer hover:scale-101 hover:caret-card-outline-hover active:ring active:ring-primary active:caret-card-outline-active active:scale-100":""} bg-card-background box-border border-card-outline border-2 backdrop-blur-sm flex p-4 flex-col rounded-xl`,onClick:r,children:[e.jsx("div",{className:"text-2xl font-bold pb-2",children:n}),e.jsx("div",{className:"flex-1",children:a})]});ie.propTypes={className:d.string,header:d.string,onClick:d.func,children:d.node.isRequired};const ve=()=>e.jsx("footer",{children:"This is a footer. Edit me in src/components/CustomFooter.jsx"}),re=({className:s="",children:n,onClick:r=()=>{}})=>{const[a,l]=t.useState(!1),[m,x]=t.useState(!1),f=async()=>{x(!0),await r(),x(!1)};return e.jsx("div",{className:`${m?"pointer-events-none opacity-50":""} ${s} px-3 py-1 w-full rounded-md hover:bg-interactive-hover
        active:bg-interactive-active active:ring-background-secondary active:ring truncate text-primary-text text-center font-medium text-lg cursor-pointer`,onClick:f,onPointerDown:()=>l(!0),onPointerCancel:()=>l(!1),onPointerUp:()=>l(!1),onPointerLeave:()=>l(!1),children:e.jsx("div",{className:`transition-transform w-full ${a?"scale-[97%]":""}`,children:n})})};re.propTypes={className:d.string,onClick:d.func,children:d.node.isRequired};const Ae=s=>s*parseFloat(getComputedStyle(document.documentElement).fontSize),Y=(s,n)=>{t.useEffect(()=>{n===void 0?console.log(`${s}: %c${n}`,"color: navy; font-weight: bold;"):n===null?console.log(`${s}: %c${n}`,"color: red; font-weight: bold;"):console.log(s,n)},[s,n])},xe=(s,n,r=null)=>{const a=t.useRef(null),l=t.useRef(s);t.useEffect(()=>{l.current=s},[s]);const m=t.useCallback((...x)=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{l.current(...x)},n)},[n]);return t.useEffect(()=>{r!==null&&l.current()},r??[]),m},rt=(s,n)=>{const r=localStorage.getItem(s);if(r!==null)try{return JSON.parse(r)}catch(a){console.error(`Error parsing localStorage item ${s}:`,a)}return n instanceof Function?n():n},Le=(s,n)=>{const[r,a]=t.useState(()=>rt(s,n));return t.useEffect(()=>{localStorage.setItem(s,JSON.stringify(r))},[s,r]),[r,a]},Pe=52,ce={isSmallScreen:window.innerWidth<Ae(Pe),dimensions:{width:window.innerWidth,height:window.innerHeight},isOnline:navigator.onLine},ae=t.createContext(ce),$e=({children:s})=>{const[n,r]=t.useState(ce.isSmallScreen),[a,l]=t.useState(ce.dimensions),m=xe(({width:N,height:j})=>l({width:N,height:j}),300),[x,f]=t.useState(ce.isOnline),S=Ae(Pe);return t.useEffect(()=>{const N=()=>{const p=window.innerWidth,i=window.innerHeight;m({width:p,height:i}),r(p<S)},j=()=>f(!0),y=()=>f(!1);return window.addEventListener("resize",N),window.addEventListener("online",j),window.addEventListener("offline",y),()=>{window.removeEventListener("resize",N),window.removeEventListener("online",j),window.removeEventListener("offline",y)}},[S,m]),e.jsx(ae.Provider,{value:{isSmallScreen:n,dimensions:a,isOnline:x},children:s})};$e.propTypes={children:d.node.isRequired};const it=s=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",width:512,height:512,...s},t.createElement("path",{d:"M15.4,9.88,10.81,5.29a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42L14,11.29a1,1,0,0,1,0,1.42L9.4,17.29a1,1,0,0,0,1.41,1.42l4.59-4.59A3,3,0,0,0,15.4,9.88Z"})),at=s=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",width:512,height:512,...s},t.createElement("path",{d:"M19,2H5C2.243,2,0,4.243,0,7v10c0,2.757,2.243,5,5,5h14c2.757,0,5-2.243,5-5V7c0-2.757-2.243-5-5-5ZM2,17V7c0-1.654,1.346-3,3-3H13V20H5c-1.654,0-3-1.346-3-3Zm20,0c0,1.654-1.346,3-3,3h-4V4h4c1.654,0,3,1.346,3,3v10Zm-2-6c0,.553-.448,1-1,1h-1c-.552,0-1-.447-1-1s.448-1,1-1h1c.552,0,1,.447,1,1Zm0,4c0,.553-.448,1-1,1h-1c-.552,0-1-.447-1-1s.448-1,1-1h1c.552,0,1,.447,1,1Zm0-8c0,.553-.448,1-1,1h-1c-.552,0-1-.447-1-1s.448-1,1-1h1c.552,0,1,.447,1,1Z"})),ot={apiKey:"AIzaSyBOS586Glw04Yc02cT15X9h7q0xMCNkJGM",authDomain:"project-last-minute.firebaseapp.com",projectId:"project-last-minute",storageBucket:"project-last-minute.firebasestorage.app",messagingSenderId:"465198803740",appId:"1:465198803740:web:53c0d2690e0cc343d3e8d9",measurementId:"G-2L8JDEKDWT"},ue=He(ot),Z=ze(ue),D=_e(ue),pe=Ze(ue);We(ue);const ct={user:void 0,signUp:async()=>Promise.resolve(),signIn:async()=>Promise.resolve(),signOut:async()=>Promise.resolve(),applyTutor:async()=>Promise.resolve(),addTutor:async()=>Promise.resolve(),addAdmin:async()=>Promise.resolve()},Q=t.createContext(ct),Be=({children:s})=>{const[n,r]=t.useState(void 0);Y("user",n),t.useEffect(()=>{const y=Ke(Z,async p=>{if(console.log("User claims updated! New ID token:",p),p){const i=await p.getIdTokenResult(!0);p.claims=i.claims}r(p),p||localStorage.clear()});return()=>y()},[]);const a=async({email:y,password:p})=>{try{await Qe(Z,y,p),console.log("Signed up successfully!")}catch(i){console.error("Error signing up:",i)}},l=async({email:y,password:p})=>{try{await Je(Z,y,p)}catch(i){console.error("Error signing in:",i)}},m=async()=>{try{await Ie(Z)}catch(y){console.error("Error signing out:",y)}},x=async()=>{var y;try{if((y=n.claims)!=null&&y.isTutor){alert("You are already a tutor!");return}if((await le(D,"tutorApplications",n.uid).get()).exists()){alert("You have already applied to be a tutor!");return}await Ye(le(D,"tutorApplications",n.uid),{email:n.email,uid:n.uid,displayName:n.displayName,photoURL:n.photoURL}),alert("You have successfully applied to be a tutor!")}catch(p){alert(p)}},f=he(pe,"setTutorClaim"),S=async y=>{try{result=await f({email:y,isTutor:!0}),alert(result)}catch(p){alert(p)}},N=he(pe,"setAdminClaim"),j=async y=>{try{console.log(y),result=await N({email:y,isAdmin:!0}),alert(result)}catch(p){alert(p)}};return e.jsx(Q.Provider,{value:{user:n,signUp:a,signIn:l,signOut:m,applyTutor:x,addTutor:S,addAdmin:j},children:s})};Be.propTypes={children:d.node.isRequired};const me="4.5rem",de={type:"spring",stiffness:170,damping:26,mass:1,restDelta:.001,velocity:.5},Me=({scrollContainerRef:s={current:null}})=>{var i;const{user:n}=t.use(Q),[r,a]=t.useState(!1),[l,m]=t.useState(!1),{isSmallScreen:x}=t.use(ae),f=De(),S=async()=>{await Ie(Z).then(()=>{console.log("Signed out successfully!"),f("/auth")}).catch(v=>{console.error("Error signing out:",v)})};t.useEffect(()=>{x&&a(!1)},[x]),t.useEffect(()=>{const v=()=>{m(s.current.scrollTop>0)},u=s.current;return u&&u.addEventListener("scroll",v),()=>{u&&u.removeEventListener("scroll",v)}},[s]);const N=n?[{name:"Dashboard",path:"/"},(i=n.claims)!=null&&i.isAdmin?{name:"Requests",path:"/requests"}:{name:"Booking",path:"/booking"},{name:"History",path:"/history"},{name:"Settings",path:"/settings"}]:[{name:"Home",path:"/"},{name:"Contact",path:"/contact"},{name:"FAQ",path:"/faq"}],j={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0},exit:{opacity:0,y:10,transition:{delay:n?.1:.15,duration:.2}}},y={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05,staggerDirection:-1,duration:.3}},exit:{opacity:0,transition:{staggerChildren:.05,staggerDirection:-1,duration:.3}}},p={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.3}},exit:{opacity:0,y:10,transition:{duration:.2}}};return e.jsxs("nav",{className:`fixed h-[4.5rem] z-10 top-0 flex justify-between w-full py-4 px-6
        border-b border-transparent transition-colors bg-background duration-300 ${l?"!border-background-secondary/30":""}`,children:[e.jsx(I.div,{className:"flex items-center text-2xl justify-start max-md:flex-1",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:de,children:e.jsx(G,{to:"/",className:"font-semibold text-nowrap focus:ring-offset-2",children:"Last Minute"})}),x?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-min aspect-square flex !p-1.5 items-center justify-center",onClick:()=>a(!r),children:e.jsx(at,{width:28,height:28})}),e.jsx(J,{mode:"wait",children:r&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{className:"absolute z-20 top-0 left-0 w-screen h-screen bg-background-secondary/30",initial:{opacity:0},animate:{opacity:1,backdropFilter:"blur(4px)"},exit:{opacity:0,transition:{delay:.3,duration:.3}},onClick:()=>a(!1)}),e.jsxs(I.div,{className:"w-72 max-w-4/5 fixed z-30 top-0 text-end flex flex-col px-6 py-4 right-0 h-screen bg-background",initial:{x:"100%",boxShadow:"0px 0px 0px 0px rgba(0, 0, 0, 0)"},animate:{x:0,boxShadow:"3px 0px 10px 2px rgba(0, 0, 0, 0.1)"},exit:{x:"100%",boxShadow:"0px 0px 0px 0px rgba(0, 0, 0, 0.1)"},transition:de,children:[e.jsx(re,{className:"w-min aspect-square flex !p-1 items-center mb-2 justify-center ml-auto",onClick:()=>a(!1),children:e.jsx(it,{width:32,height:32})}),e.jsx(G,{to:"/auth",className:"flex",children:e.jsx(E,{filled:!0,className:"flex-1",onClick:()=>{a(!1),S()},children:n?"Sign out":"Sign in / Register"})}),e.jsx("p",{className:"text-lg font-semibold mr-3 mt-6 mb-2",children:"Navigation"}),N.map(v=>e.jsx(G,{to:v.path,className:({isActive:u})=>u?" bg-background-secondary/50 rounded-md pointer-events-none":void 0,children:e.jsx(re,{onClick:()=>a(!1),className:"py-2 flex justify-end text-right",children:v.name})},v.name))]})]})})]}):e.jsxs("div",{className:"text-lg font-medium items-center justify-end inline-flex top-0 py-0 gap-4",children:[e.jsx(J,{mode:"wait",children:e.jsx(I.div,{className:"inline-flex gap-2",initial:"hidden",animate:"visible",exit:"exit",variants:y,children:N.map((v,u)=>e.jsx(I.div,{custom:u,variants:j,children:e.jsx(G,{to:v.path,className:({isActive:T})=>T?"underline underline-offset-4 underline-primary pointer-events-none":void 0,children:e.jsx(re,{children:v.name})})},v.name))},n?"user-nav":"guest-nav")}),e.jsx(J,{mode:"wait",children:n?e.jsx(I.div,{className:"flex gap-2 flex-row",initial:"hidden",animate:"visible",exit:"exit",variants:y,children:e.jsx(I.div,{variants:p,children:e.jsx(E,{onClick:()=>S(),children:"Sign out"})})},"user-auth"):e.jsxs(I.div,{className:"flex gap-2 flex-row",initial:"hidden",animate:"visible",exit:"exit",variants:y,children:[e.jsx(I.div,{variants:p,children:e.jsx(G,{to:{pathname:"/auth"},state:{action:"register"},className:({isActive:v})=>`flex-1 flex transition-opacity ${v?"pointer-events-none opacity-50":""}`,children:e.jsx(E,{children:"Register"})})}),e.jsx(I.div,{variants:p,children:e.jsx(G,{to:{pathname:"/auth"},state:{action:"signin"},className:({isActive:v})=>`flex-1 flex transition-opacity ${v?"pointer-events-none opacity-50":""}`,children:e.jsx(E,{filled:!0,children:"Sign in"})})})]},"guest-auth")})]})]})};Me.propTypes={scrollContainerRef:d.object.isRequired};const lt=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"this is a FAQ. Edit me in src/components/FAQ.jsx"}),e.jsx(ve,{})]}),_=({label:s="",onChange:n=()=>{},className:r,validateFunction:a,multiline:l=!1,options:m=[],onOptionSelect:x=()=>{},type:f,value:S="",forceSuggestions:N=!1,autoSave:j=!1,saveDelay:y=1e3,ref:p,...i})=>{const v=j||`form_${i.name}`,[u,T]=Le(j?v:null,S),[H,F]=t.useState(""),[k,P]=t.useState(!1),[B,W]=t.useState(-1),[h,C]=t.useState(m),[g,R]=t.useState(j&&u?u:S),[$,U]=t.useState(!1),z=t.useRef(null),te=t.useRef(null),o=t.useRef(null),w=xe(c=>{j&&(T(c),console.log(`Auto-saved value for ${i.name}: ${c}`))},y);t.useEffect(()=>{if(B>=0&&z.current&&f==="suggest"&&k)try{const c=z.current.querySelectorAll("div");if(c&&c.length>B){const b=c[B];if(b){const L=z.current.getBoundingClientRect(),K=b.getBoundingClientRect();(K.bottom>L.bottom||K.top<L.top)&&b.scrollIntoView({behavior:"smooth",block:"nearest"})}}}catch(c){console.error("Error scrolling dropdown option into view:",c)}},[B,k,f]),t.useImperativeHandle(p,()=>({validate:()=>O(g),getSavedValue:()=>u,saveValue:c=>j&&T(c||g),reset:()=>{R(""),T("")}})),t.useEffect(()=>{const c=b=>{k&&te.current&&!te.current.contains(b.target)&&z.current&&!z.current.contains(b.target)&&P(!1)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[k]),t.useEffect(()=>{f==="suggest"&&q(g)},[m,g,f]),t.useEffect(()=>{(S!==""||!j)&&(R(S),S===""&&U(!1))},[S,j]),t.useEffect(()=>()=>{j&&g&&(T(g),console.log(`Saved ${i.name} value on unmount: ${g}`))},[]);const q=c=>{if(!c.length){C(m);return}const b=c.toLowerCase(),L=m.filter(K=>typeof K=="string"?K.toLowerCase().includes(b):K.label.toLowerCase().includes(b));C(L),W(L.length>0?0:-1)},O=async c=>{if(i.required&&(!c||c.trim()===""))return F("This field is required"),!1;if(f==="suggest"&&N&&c&&!$&&!m.some(L=>(typeof L=="string"?L:L.label).toLowerCase()===c.toLowerCase()))return F("Please select a value from the options available"),!1;if(a)try{return await a(c),F(""),!0}catch(b){return F(b.message),!1}else return F(""),!0},A=xe(O,500),we=c=>{F("");const b=c.target.value;R(b),f==="suggest"&&(U(!1),q(b)),A(b),w(b),n(c)},Ve=()=>{P(!0)},be=c=>{if(O(g),j&&T(g),f!=="suggest"){P(!1);return}(c.relatedTarget===null||z.current&&!z.current.contains(c.relatedTarget))&&requestAnimationFrame(()=>{P(!1)})},Ce=c=>{const b=typeof c=="string"?c:c.value,L=typeof c=="string"?c:c.label;R(L),U(!0);const K={target:{name:i.name,value:b}};n(K),x(b,L),P(!1),F(""),j&&T(L)},Fe=c=>{!k||f!=="suggest"||!h.length||(c.key==="ArrowDown"?(c.preventDefault(),W(b=>b<h.length-1?b+1:0)):c.key==="ArrowUp"?(c.preventDefault(),W(b=>b>0?b-1:h.length-1)):c.key==="Enter"&&B>=0?(c.preventDefault(),Ce(h[B])):c.key==="Escape"?(c.preventDefault(),P(!1)):c.key==="Tab"&&P(!1))},Se=`${H&&!k?"!border-error":""} 
      mt-0.5 flex bg-white border-2 border-primary/50 transition-all rounded p-2 focus:outline-none focus:ring-2 focus:ring-primary font-medium`;return f==="display"?e.jsx("input",{className:`${r} pointer-events-none`,type:"text",name:i.name,value:u}):e.jsxs(I.label,{className:`${r} w-full flex flex-col text-sm font-semibold relative`,htmlFor:i.name,layout:!0,ref:te,children:[s,i.required&&"*",l?e.jsx("textarea",{...i,value:g,name:i.name,disabled:i.disabled,rows:l===!0?3:l,onChange:we,onBlur:be,className:`${Se} resize-none min-h-[70px]`,ref:p}):e.jsx("input",{name:i.name,value:g,type:f==="suggest"?"text":f,onChange:we,onFocus:Ve,onBlur:be,onKeyDown:Fe,disabled:i.disabled,placeholder:i.placeholder,className:Se,min:i.min,max:i.max,autoComplete:f==="suggest"?"off":i.autoComplete,ref:p}),f==="suggest"?e.jsx(J,{children:k&&h.length>0&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0,transition:{duration:.1}},exit:{opacity:0,y:-10,transition:{duration:.1}},transition:de,className:"absolute left-0 right-0 top-full mt-1 max-h-60 overflow-y-auto rounded-md border border-primary/30 bg-white shadow-lg z-10",ref:z,children:h.map((c,b)=>{const L=typeof c=="string"?c:c.label;return e.jsx("div",{className:`px-3 py-2 cursor-pointer hover:bg-primary/10 ${b===B?"bg-primary/20":""}`,onPointerDown:()=>Ce(c),onMouseEnter:()=>W(b),ref:b===B?o:null,children:L},b)})})}):null,e.jsx(J,{children:H&&(!h.length||!k)&&e.jsx(I.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:4},exit:{height:0,opacity:0,marginTop:0,transition:{duration:.15}},transition:de,children:e.jsx(I.p,{className:"text-error",children:H})})})]})};_.propTypes={name:d.string.isRequired,type:d.oneOf(["text","password","email","number","tel","url","search","date","datetime-local","month","week","time","color","suggest"]),onChange:d.func.isRequired,placeholder:d.string,value:d.string,required:d.bool,className:d.string,disabled:d.bool,autoSave:d.oneOfType([d.bool,d.string]),saveDelay:d.number,enterKeyHint:d.oneOf(["none","go","next","search","send"]),autoComplete:d.oneOf(["on","off","name","honorific-prefix","given-name","additional-name","family-name","honorific-suffix","nickname","email","username","new-password","current-password","organization-title","organization","street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code","cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type","transaction-currency","transaction-amount","language","bday","bday-day","bday-month","bday-year","sex","tel","tel-country-code","tel-national","tel-area-code","tel-local","tel-extension","impp","url","photo"]),autoFocus:d.bool,validateFunction:d.func,errorMessage:d.string,multiline:d.oneOfType([d.bool,d.number]),options:d.arrayOf(d.oneOfType([d.string,d.shape({label:d.string.isRequired,value:d.string.isRequired})])),onOptionSelect:d.func,forceSuggestions:d.bool,ref:d.oneOfType([d.func,d.shape({current:d.instanceOf(Element)})])};const Te=()=>e.jsxs("div",{className:"flex flex-col flex-1 items-center w-screen justify-center",style:{paddingTop:me},children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:nt,width:100,alt:"Ket"}),e.jsx("h1",{children:"Last Minute"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("p",{children:"Your courses. At your demand."}),e.jsx(E,{onClick:null,children:"I am a button"})]}),e.jsx(lt,{}),e.jsx(ve,{})]}),dt=()=>{var f;const s=De(),n=ye(),{signIn:r,signUp:a}=t.use(Q),[l,m]=t.useState(((f=n.state)==null?void 0:f.action)||"signin"),x=async()=>{await r({email:"admin@admin.com",password:"admin123"}).then(()=>{s("/")})};return e.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center",children:["auth",e.jsx(E,{onClick:()=>x(),children:"Login"})]})},ut=()=>e.jsxs("div",{className:"flex flex-col flex-1 gap-4 items-center justify-center",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"404 Page not found"}),e.jsx("p",{children:"The page you are looking for does not exist."})]}),e.jsx(Oe,{to:"/",children:e.jsx(E,{filled:!0,children:"Back to Home"})})]}),Ee=s=>(console.log("Converting:",s),!s||!s.seconds?"":(console.log("Converted:",new Date(s.seconds*1e3).toLocaleString()),new Date(s.seconds*1e3).toLocaleString())),mt=s=>{const n=new Date(s);return console.log("Converting:",n),console.log("Converted:",Ne.fromDate(n)),Ne.fromDate(n)},ft={courses:[],requests:[],requestCourse:async()=>Promise.resolve(),isRequestPending:!1,acceptRequest:async()=>Promise.resolve(),isAcceptPending:!1,cancelRequestCourse:async()=>Promise.resolve(),isCancelRequestPending:!1,cancelCourse:async()=>Promise.resolve(),isCancelPending:!1,loadNewerRequests:async()=>Promise.resolve()},oe=t.createContext(ft),je=({children:s})=>{var W;const[n,r]=t.useState([]),[a,l]=t.useState([]),[m,x]=t.useState(!1),[f,S]=t.useState(!1),[N,j]=t.useState(!1),[y,p]=t.useState(!1),[i,v]=t.useState(null),{user:u}=t.useContext(Q),T=(W=u==null?void 0:u.claims)==null?void 0:W.isTutor;Y("courses",n),Y("requests",a),Y("isTutor",T),t.useEffect(()=>{if(!Z.currentUser)return;let h,C;return T?(h=ee(X(V(D,"courses"),fe("tutorId","==",Z.currentUser.uid)),g=>{r(g.docs.map(R=>({id:R.id,...R.data()})))},g=>{console.error("Error fetching tutor courses:",g)}),C=ee(X(V(D,"requests"),ge("createdAt","desc"),ke(25)),g=>{const R=g.docs.map($=>({id:$.id,...$.data()}));g.docs.length>0&&v(g.docs[g.docs.length-1]),R.sort(($,U)=>!$.bookingTime&&U.bookingTime?-1:$.bookingTime&&!U.bookingTime?1:!$.bookingTime&&!U.bookingTime?$.createdAt.toMillis()-U.createdAt.toMillis():$.bookingTime.toMillis()-U.bookingTime.toMillis()),l(R)},g=>{console.error("Error fetching tutor requests:",g)})):(h=ee(X(V(D,"courses"),fe("tuteeId","==",Z.currentUser.uid)),g=>{r(g.docs.map(R=>({id:R.id,...R.data()})))},g=>{console.error("Error fetching student courses:",g)}),C=ee(X(V(D,"requests"),fe("tuteeId","==",Z.currentUser.uid)),g=>{l(g.docs.map(R=>({id:R.id,...R.data()})))},g=>{console.error("Error fetching student requests:",g)})),()=>{h&&h(),C&&C()}},[T]);const H=async()=>{if(T){if(!i){console.warn("No more requests to load");return}try{const h=X(V(D,"requests"),ge("createdAt","desc"),Ge(i),ke(25)),C=await Xe(h);if(!C.empty){const g=C.docs.map(R=>({id:R.id,...R.data()}));l(R=>[...R,...g]),v(C.docs[C.docs.length-1])}}catch(h){console.error("Error loading older requests:",h)}}},F=async h=>{if(T){j(!0);try{const g=await he(pe,"acceptCourseRequest")({requestId:h.id});console.log("Request accepted successfully:",g.data),alert("Request accepted successfully!")}catch(C){console.error("Error accepting request:",C),alert(`Error accepting request: ${C.message}`)}finally{j(!1)}}},k=async h=>{try{if(!h.subject||!h.topic)throw new Error("Subject and topic are required");if(h.bookingTime&&(h.bookingTime=mt(h.bookingTime),!h.bookingTime))throw new Error("Invalid booking time");if(a.some(C=>C.subject===h.subject&&C.topic===h.topic))throw new Error(`Course already requested with subject: ${h.subject} and topic: ${h.topic}`);x(!0),await se(V(D,"requests"),{tuteeId:Z.currentUser.uid,createdAt:ne(),...h}),alert("Course added successfully!")}catch(C){throw alert("Error requesting course:",C),C}finally{x(!1)}},P=async h=>{try{S(!0),await Re(le(D,"requests",h)),console.log("Course cancelled successfully!")}catch(C){console.error("Error cancelling course:",C)}finally{S(!1)}},B=async h=>{try{p(!0),await Re(le(D,"courses",h)),console.log("Course cancelled successfully!")}catch(C){console.error("Error cancelling course:",C)}finally{p(!1)}};return e.jsx(oe.Provider,{value:{courses:n,requests:a,loadNewerRequests:H,requestCourse:k,acceptRequest:F,cancelRequestCourse:P,cancelCourse:B,isRequestPending:m,isAcceptPending:N,isCancelRequestPending:f,isCancelPending:y},children:s})};je.propTypes={children:d.node.isRequired};const ht=()=>{const{courses:s}=t.useContext(oe);return e.jsx("div",{className:"w-screen flex flex-col items-center justify-center",children:e.jsx(ie,{header:"Courses",className:"w-[min(48rem,11/12*100%)] p-[min(3rem,4%)]",children:e.jsx("div",{className:"divide-y divide-primary",children:s.map(n=>e.jsxs("div",{className:"flex w-full gap-2 items-center py-2 px-4",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-bold text-xl",children:n.subject}),e.jsx("p",{className:"font-semibold",children:n.topic}),e.jsx("p",{className:`${n.details?"":"italic opacity-75"} truncate`,children:n.details||"No description"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(E,{className:"w-full",onClick:()=>null,children:"Chat"})," ",e.jsx(Oe,{to:{pathname:"/session",search:`?course=${n.id}`},children:e.jsx(E,{className:"w-full",onClick:()=>null,filled:!0,children:"Start Session"})})]})]},n.id))})})})},gt=s=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",width:512,height:512,...s},t.createElement("path",{d:"M17,10.039c-3.859,0-7,3.14-7,7,0,3.838,3.141,6.961,7,6.961s7-3.14,7-7c0-3.838-3.141-6.961-7-6.961Zm0,11.961c-2.757,0-5-2.226-5-4.961,0-2.757,2.243-5,5-5s5,2.226,5,4.961c0,2.757-2.243,5-5,5Zm1.707-4.707c.391,.391,.391,1.023,0,1.414-.195,.195-.451,.293-.707,.293s-.512-.098-.707-.293l-1-1c-.188-.188-.293-.442-.293-.707v-2c0-.552,.447-1,1-1s1,.448,1,1v1.586l.707,.707Zm5.293-10.293v2c0,.552-.447,1-1,1s-1-.448-1-1v-2c0-1.654-1.346-3-3-3H5c-1.654,0-3,1.346-3,3v1H11c.552,0,1,.448,1,1s-.448,1-1,1H2v9c0,1.654,1.346,3,3,3h4c.552,0,1,.448,1,1s-.448,1-1,1H5c-2.757,0-5-2.243-5-5V7C0,4.243,2.243,2,5,2h1V1c0-.552,.448-1,1-1s1,.448,1,1v1h8V1c0-.552,.447-1,1-1s1,.448,1,1v1h1c2.757,0,5,2.243,5,5Z"})),xt=()=>{const{isSmallScreen:s}=t.use(ae),{requestCourse:n,isRequestPending:r}=t.use(oe),[a,l]=Le("BookingDraft_Instant",!0),m=t.useRef(null),x=t.useRef(null),f=t.useRef(null),S=t.useRef(null),N=t.useRef(null);Y("isInstantBooking",a);const j=[{label:"Math",value:"math"},{label:"Science",value:"science"},{label:"English",value:"english"},{label:"History",value:"history"},{label:"Computer Science",value:"computer-science"},{label:"Art",value:"art"},{label:"Music",value:"music"},{label:"Physical Education",value:"physical-education"},{label:"Other",value:"other"}],y=async i=>{i.preventDefault();let v=!0;if(v=await x.current.validate()&&v,v=await f.current.validate()&&v,v=await S.current.validate()&&v,N.current&&(v=await N.current.validate()&&v),!v)return;const u=new FormData(m.current),T=Object.fromEntries(u.entries());console.log("Submitting:",T);try{await n(T),x.current.reset(),f.current.reset(),S.current.reset(),N.current.reset(),l(!0)}catch(H){alert(`Error requesting course: ${H.message}`)}},p=async()=>{let i=!0;i=await x.current.validate()&&i,i=await f.current.validate()&&i,i=await S.current.validate()&&i,i&&l(!1)};return e.jsx("div",{className:"flex flex-col w-full items-center justify-center",children:e.jsx(ie,{header:a?"Instant Booking":"Schedule Booking",className:"w-[min(48rem,11/12*100%)] p-[min(3rem,4%)]",children:e.jsx("div",{className:"gap-2 ",children:e.jsx("form",{onSubmit:y,className:"focus:!ring-0",tabIndex:"0",ref:m,children:a?e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsx(_,{ref:x,name:"topic",label:"Topic",type:"text",disabled:r,placeholder:"Topics, keywords, etc.",required:!0,autoSave:"BookingDraft_Topic"}),e.jsx(_,{ref:f,name:"subject",label:"Subject",type:"suggest",disabled:r,options:j,placeholder:"Select a subject",required:!0,forceSuggestions:!0,autoSave:"BookingDraft_Subject"}),e.jsx(_,{ref:S,name:"details",label:"Details",multiline:5,disabled:r,placeholder:"I need help with this particular question...",autoSave:"BookingDraft_Details"}),e.jsxs("div",{className:"mt-4 w-full flex gap-2",children:[e.jsx(E,{disabled:r,className:s?"":"flex-1",onClick:()=>p(),children:s?e.jsx(gt,{width:24,height:24}):"Schedule Booking"}),e.jsx(E,{disabled:r,className:"flex-1",filled:!0,type:"submit",children:"Instant Booking"})]})]}):e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsx(_,{ref:x,name:"topic",type:"display",autoSave:"BookingDraft_Topic"}),e.jsx(_,{ref:f,name:"subject",type:"display",options:j,autoSave:"BookingDraft_Subject"}),e.jsx(_,{ref:S,name:"details",multiline:5,type:"display",autoSave:"BookingDraft_Details",className:"text-ellipsis"}),e.jsx(_,{ref:N,min:new Date().toISOString().slice(0,16),max:new Date(Date.now()+14*24*60*60*1e3).toISOString().slice(0,16),step:900,validateFunction:i=>{if(console.log("Checking",i),new Date(i)<Date.now())throw new Error("Date and time must be in the future");if(new Date(i)>Date.now()+14*24*60*60*1e3)throw new Error("Date and time must be within the next 14 days")},name:"bookingTime",label:"Date and Time",type:"datetime-local",disabled:r,required:!0,autoSave:"BookingDraft_DateTime",className:"flex-1"}),e.jsx(E,{type:"submit",filled:!0,children:"Book"})]})})})})})},pt=()=>{const{user:s}=t.useContext(Q),{isSmallScreen:n}=t.useContext(ae),{courses:r}=t.useContext(oe),[a,l]=t.useState(null),[m,x]=t.useState(null),[f,S]=t.useState([]),[N,j]=t.useState("disconnected"),[y,p]=t.useState(null),[i,v]=t.useState(!1);Y("chatMessages",f),Y("callStatus",N),Y("currentCourse",y);const u=t.useRef(null),T=t.useRef(null),H=t.useRef(null),{search:F}=ye(),k=new URLSearchParams(F).get("course");t.useEffect(()=>{if(k&&r.length>0){const o=r.find(w=>w.id===k);o&&(p(o),v(o.tutorId===s.uid))}},[k,r,s]);const P=t.useCallback(o=>{if(o)try{o.getTracks().forEach(w=>{w.stop()})}catch(w){console.error("Error stopping media tracks:",w)}},[]);t.useEffect(()=>{const o={iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceCandidatePoolSize:10};u.current=new RTCPeerConnection(o);const w=new MediaStream;return x(w),u.current.ontrack=q=>{q.streams[0].getTracks().forEach(O=>{w.addTrack(O)})},u.current.onicecandidate=q=>{q.candidate&&g(q.candidate.toJSON())},u.current.onconnectionstatechange=()=>{switch(u.current.connectionState){case"connected":j("connected");break;case"disconnected":case"failed":j("disconnected");break;case"connecting":j("connecting");break}},k&&B(),()=>{u.current&&u.current.close()}},[k]),t.useEffect(()=>()=>{P(a)},[a,P]);const B=()=>{const o=V(D,"courses",k,"signaling");return ee(o,q=>{q.docChanges().forEach(async O=>{if(O.type==="added"){const A=O.doc.data();A.type==="offer"&&!i?await h(A):A.type==="answer"&&i?await C(A):A.type==="candidate"&&(i&&A.from!==s.uid||!i&&A.from!==s.uid)&&R(A)}})})},W=async()=>{try{if(!u.current||!a)return;const o=await u.current.createOffer();await u.current.setLocalDescription(o);const w={type:"offer",sdp:o.sdp,from:s.uid,timestamp:ne()};await se(V(D,"courses",k,"signaling"),w),j("connecting")}catch(o){console.error("Error creating offer:",o)}},h=async o=>{try{(!u.current||!a)&&await $();const w={type:"offer",sdp:o.sdp};await u.current.setRemoteDescription(new RTCSessionDescription(w));const q=await u.current.createAnswer();await u.current.setLocalDescription(q);const O={type:"answer",sdp:q.sdp,from:s.uid,timestamp:ne()};await se(V(D,"courses",k,"signaling"),O),j("connecting")}catch(w){console.error("Error handling offer:",w)}},C=async o=>{try{const w={type:"answer",sdp:o.sdp};await u.current.setRemoteDescription(new RTCSessionDescription(w))}catch(w){console.error("Error handling answer:",w)}},g=async o=>{try{await se(V(D,"courses",k,"signaling"),{type:"candidate",candidate:o,from:s.uid,timestamp:ne()})}catch(w){console.error("Error adding ICE candidate:",w)}},R=async o=>{try{u.current&&o.candidate&&await u.current.addIceCandidate(new RTCIceCandidate(o.candidate))}catch(w){console.error("Error handling ICE candidate:",w)}},$=async()=>{try{P(a);const o=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});l(o),o.getTracks().forEach(w=>{u.current.addTrack(w,o)}),i&&await W()}catch(o){console.error("Error starting call:",o)}},U=()=>{try{P(a),l(null),u.current&&u.current.close(),j("disconnected")}catch(o){console.error("Error ending call:",o)}};t.useEffect(()=>{if(!k)return;const o=X(V(D,"courses",k,"chat"),ge("createdAt","asc")),w=ee(o,q=>{const O=q.docs.map(A=>({id:A.id,...A.data()}));S(O)},q=>{console.error("Error fetching chat messages:",q)});return()=>w()},[k]);const z=async o=>{o.preventDefault();const w=new FormData(T.current),O=Object.fromEntries(w.entries()).message;if(O.trim())try{await se(V(D,"courses",k,"chat"),{text:O,senderId:s.uid,createdAt:ne()}),H.current.reset()}catch(A){console.error("Error sending message:",A)}},te=()=>N==="connected"?e.jsx("div",{className:"bg-green-500 text-white px-3 py-1 rounded-md",children:"Connected"}):N==="connecting"?e.jsx("div",{className:"bg-yellow-500 text-white px-3 py-1 rounded-md",children:"Connecting..."}):e.jsx("div",{className:"bg-gray-500 text-white px-3 py-1 rounded-md",children:"Disconnected"});return e.jsxs("div",{style:{paddingTop:me},className:"w-screen flex flex-row",children:[e.jsx("div",{className:"flex-1 flex",children:e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center px-4 py-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:y?y.subject+": "+y.topic:"Loading course..."}),te()]}),e.jsxs("div",{className:"flex-1 flex flex-row",children:[!n&&e.jsx("div",{className:"flex-1 bg-black flex justify-center items-center",children:a?e.jsx("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:o=>{o&&(o.srcObject=a)},className:"w-full max-w-md h-auto"}):e.jsx("div",{className:"text-white",children:"Your camera is off"})}),e.jsx("div",{className:"flex-1 bg-gray-900 flex justify-center items-center",children:m&&N==="connected"?e.jsx("video",{autoPlay:!0,playsInline:!0,ref:o=>{o&&(o.srcObject=m)},className:"w-full max-w-md h-auto"}):e.jsx("div",{className:"text-white",children:N==="connecting"?"Connecting...":"Waiting for other participant"})})]}),e.jsx("div",{className:"px-4 py-2 flex gap-2 justify-center",children:N==="disconnected"?e.jsx(E,{onClick:$,filled:!0,children:i?"Start Session":"Join Session"}):e.jsx(E,{onClick:U,children:"End Call"})})]})}),e.jsx(ie,{header:"Chat",className:"min-w-xs max-w-sm",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex flex-1 flex-col overflow-y-auto",children:f.map(o=>e.jsxs("div",{className:`mb-2 ${o.senderId===s.uid?"ml-auto":""}`,style:{maxWidth:"80%"},children:[e.jsx("div",{className:"text-sm font-semibold",children:o.senderId===s.uid?"You":i?"Student":"Tutor"}),e.jsx("div",{className:`p-2 rounded ${o.senderId===s.uid?"bg-primary/20 text-primary-text":"bg-gray-100 text-primary-text"}`,children:o.text})]},o.id))}),e.jsxs("form",{className:"flex gap-2 items-center",ref:T,onSubmit:o=>z(o),children:[e.jsx(_,{ref:H,name:"message",type:"text",placeholder:"Type a message..."}),e.jsx(E,{type:"submit",children:"Send"})]})]})})]})},yt=()=>{const{applyTutor:s,addAdmin:n}=t.use(Q),[r,a]=t.useState("");return Y("textInput",r),e.jsxs("div",{style:{paddingTop:me},className:"flex w-screen flex-col px-8 gap-4 items-center justify-center",children:[e.jsx(_,{placeholder:"Add email as admin",value:r,onChange:l=>a(l.target.value)}),e.jsx(E,{onClick:()=>n(r),children:"Add as Admin"}),e.jsx(E,{onClick:()=>s(r),children:"Apply myself for Tutor"})]})},vt=()=>{const{isOnline:s}=t.use(ae);return e.jsx("div",{children:s?"Loading...":"You are offline"})},qe=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Contact"}),e.jsx(ve,{})]}),jt=()=>e.jsx("div",{style:{paddingTop:me},children:"History"}),wt=()=>{const{requests:s,acceptRequest:n}=t.useContext(oe);return e.jsx("div",{className:"w-screen flex flex-col items-center justify-center",children:e.jsx(ie,{header:"Requests",className:"w-[min(48rem,11/12*100%)] overflow-hidden max-h-2/3 p-[min(3rem,4%)]",children:e.jsx("div",{className:"divide-y flex flex-col divide-primary overflow-y-auto max-h-1/2",children:s.map(r=>e.jsxs("div",{className:"flex w-full gap-2 items-center py-2 px-4",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-bold text-xl",children:r.subject}),e.jsx("p",{className:"font-semibold",children:r.topic}),e.jsx("p",{className:`${r.details?"":"italic opacity-75"} truncate`,children:r.details||"No description"}),e.jsx("p",{children:r.bookingTime?Ee(r.bookingTime):`Ordered at: ${Ee(r.createdAt)}`})]}),e.jsx(E,{className:"ml-auto",onClick:()=>n(r),children:"Accept"})]},r.id))})})})},bt=()=>e.jsx(je,{children:e.jsx(tt,{})});function Ct(){var a;const{user:s}=t.use(Q),n=ye(),r=t.useRef(null);return e.jsx(J,{mode:"wait",children:s===void 0?e.jsx(I.div,{className:"w-screen h-screen flex justify-center items-center text-primary-text",animate:{opacity:1,transition:{duration:1}},exit:{opacity:0},children:e.jsx(vt,{})},"loading"):e.jsx(I.div,{className:"w-screen h-screen overflow-hidden flex-col flex text-primary-text",initial:{opacity:0},animate:{opacity:1,transition:{duration:1}},exit:{opacity:0},children:e.jsxs($e,{children:[e.jsx(Me,{scrollContainerRef:r}),e.jsx(J,{mode:"wait",children:e.jsx(I.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{duration:.5}},exit:{opacity:0,transition:{duration:.3}}},ref:r,initial:"initial",animate:"animate",exit:"exit",className:"w-full overflow-y-auto h-screen flex",children:e.jsxs(et,{location:n,children:[e.jsx(M,{path:"/",element:s?e.jsx(je,{children:e.jsx(ht,{})}):e.jsx(Te,{})}),s?e.jsxs(M,{element:e.jsx(bt,{}),children:[(a=s.claims)!=null&&a.isTutor?e.jsx(M,{path:"/requests",element:e.jsx(wt,{})}):e.jsx(M,{path:"/booking",element:e.jsx(xt,{})}),e.jsx(M,{path:"/session",element:e.jsx(pt,{})}),e.jsx(M,{path:"/history",element:e.jsx(jt,{})}),e.jsx(M,{path:"/settings",element:e.jsx(yt,{})}),e.jsx(M,{path:"/landing",element:e.jsx(Te,{})}),e.jsx(M,{path:"/contact",element:e.jsx(qe,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{path:"/auth",element:e.jsx(dt,{})}),e.jsx(M,{path:"/contact",element:e.jsx(qe,{})})]}),e.jsx(M,{path:"*",element:e.jsx(ut,{})})]},n.pathname)},n.pathname+(s?"-auth":"-guest"))})]})},"loaded")})}Ue.createRoot(document.getElementById("root")).render(e.jsx(Be,{children:e.jsx(st,{basename:"/last-minute/",children:e.jsx(Ct,{})})}));
